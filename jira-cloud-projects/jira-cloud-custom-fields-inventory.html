<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jira Cloud Custom Fields Inventory (Python)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background: #fafafa;
      color: #222;
    }
    header, main {
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5rem 1rem 2rem;
    }
    nav a {
      text-decoration: none;
      color: #2563eb;
      font-weight: 500;
    }
    h1, h2, h3 {
      color: #111827;
    }
    section {
      background: #ffffff;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1.25rem;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
    }
    code {
      background: #f3f4f6;
      padding: 0.1rem 0.25rem;
      border-radius: 4px;
      font-size: 0.95em;
    }
    pre {
      background: #0b1120;
      color: #e5e7eb;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.9em;
    }
    ul {
      padding-left: 1.2rem;
    }
    .meta p {
      margin: 0.15rem 0;
    }
    .tag {
      display: inline-block;
      font-size: 0.8rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-right: 0.35rem;
    }
    .small-note {
      font-size: 0.85rem;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">← Home</a>
    </nav>
  </header>

  <main>
    <section id="jira-cloud-custom-fields-inventory">
      <h1>Jira Cloud Custom Fields Inventory</h1>

      <div class="meta">
        <p><strong>Language:</strong> Python</p>
        <p><strong>Difficulty:</strong> Medium</p>
        <p>
          <span class="tag">Jira Cloud REST API</span>
          <span class="tag">Custom Fields</span>
          <span class="tag">GitHub Actions</span>
          <span class="tag">CSV Export</span>
        </p>
      </div>

      <hr>

      <h2>Description</h2>
      <p>
        This script connects to a Jira Cloud instance and builds a complete inventory of
        all custom fields, their contexts, and their option values.
        It uses the Jira Cloud REST API (<code>/rest/api/3</code>) to:
      </p>
      <ul>
        <li>Authenticate using an email + API token stored as GitHub Actions secrets.</li>
        <li>Fetch the global list of fields and filter only custom fields.</li>
        <li>Retrieve all contexts per custom field, including project and issue type bindings.</li>
        <li>Resolve option values (including cascading options) either via the context option API or via editmeta fallback.</li>
        <li>Export everything to a timestamped JSON and CSV in the <code>Downloads</code> directory.</li>
      </ul>
      <p>
        The script is intended to run via GitHub Actions, using environment variables wired to
        repository secrets so that no credentials are ever committed to the repository.
      </p>

      <h2>Structure</h2>
      <ol>
        <li>
          <strong>Jira Cloud configuration</strong><br>
          Reads the Jira Cloud base URL, email and API token from environment variables
          (<code>JIRA_CLOUD_URL</code>, <code>JIRA_CLOUD_EMAIL</code>, <code>JIRA_CLOUD_TOKEN</code>),
          which are populated from GitHub Actions secrets.
        </li>
        <li>
          <strong>Scope definition</strong><br>
          Optional filters such as <code>TARGET_FIELD_ID</code> (to focus on a single custom field) and
          <code>PROJECT_KEYS_WHITELIST</code> / <code>PROJECT_IDS_WHITELIST</code> to limit projects
          used when probing options via editmeta.
        </li>
        <li>
          <strong>Authentication &amp; session</strong><br>
          Creates a <code>requests.Session</code> authenticated with Jira Cloud
          (<code>email + API token</code>) and sets common headers.
        </li>
        <li>
          <strong>Output file setup</strong><br>
          Builds timestamped paths in the local <code>Downloads</code> folder for:
          <ul>
            <li>A raw JSON dump of <code>/rest/api/3/field</code>.</li>
            <li>A CSV summarizing fields, contexts, and option values.</li>
          </ul>
        </li>
        <li>
          <strong>Core helpers</strong><br>
          <ul>
            <li><code>jira_get(path, params)</code> &mdash; thin wrapper around Jira Cloud GET calls.</li>
            <li><code>is_option_field(field)</code> &mdash; detects whether a field is option-based (select, multiselect, etc.).</li>
            <li><code>get_contexts_for_field(field_id)</code> &mdash; paginates over <code>/field/{fieldId}/context</code>.</li>
            <li><code>get_sample_issue_keys(...)</code> &mdash; uses <code>/search/jql</code> to find issues where the field is present.</li>
            <li><code>get_options_from_editmeta(...)</code> &mdash; fallback to <code>editmeta</code> when context options are not available.</li>
            <li><code>get_options_via_context_api(...)</code> &mdash; primary method to resolve option values per context.</li>
            <li><code>get_all_projects_cloud()</code> &mdash; paginates over <code>/project/search</code> to map projects by id/key.</li>
          </ul>
        </li>
        <li>
          <strong>Field &amp; context processing</strong><br>
          For each custom field:
          <ul>
            <li>Fetches all Jira Cloud contexts.</li>
            <li>Resolves project and issue type bindings for each context.</li>
            <li>Determines whether the field is option-based using <code>is_option_field</code>.</li>
            <li>Attempts to retrieve options via the context option API, falling back to editmeta where necessary.</li>
          </ul>
        </li>
        <li>
          <strong>Row building</strong><br>
          For every combination of <code>(field, context, option)</code>, a row is appended with:
          <ul>
            <li>Field id, name, schema metadata.</li>
            <li>Context id, name, project and issue type bindings.</li>
            <li>Option id/value and parent option when applicable (cascading fields).</li>
            <li>A visibility note describing any limitations or warnings (for example, when no options are visible in editmeta).</li>
          </ul>
        </li>
        <li>
          <strong>CSV export</strong><br>
          Writes all rows to a CSV file using <code>csv.DictWriter</code>, preserving a stable,
          analysis-friendly schema that can be opened in Excel or loaded into analytics tools.
        </li>
      </ol>

      <h2>Key Variables &amp; Parameters</h2>
      <ul>
        <li><code>JIRA_CLOUD_URL</code> – Jira Cloud base URL (e.g., <code>https://your-domain.atlassian.net</code>), injected via secrets.</li>
        <li><code>JIRA_CLOUD_EMAIL</code> – Jira account email used for API authentication.</li>
        <li><code>JIRA_CLOUD_TOKEN</code> – Jira Cloud API token (never committed, only passed as a secret).</li>
        <li><code>TARGET_FIELD_ID</code> – If set, filters processing to a single custom field ID (e.g., <code>"customfield_10001"</code>).</li>
        <li><code>PROJECT_KEYS_WHITELIST</code> – Optional list of project keys to limit where sample issues are searched.</li>
        <li><code>PROJECT_IDS_WHITELIST</code> – Optional list of project IDs to further constrain the search space.</li>
        <li><code>OUTPUT_FIELDS_JSON</code> – Path to the raw JSON dump of the Jira Cloud fields endpoint.</li>
        <li><code>OUTPUT_CSV</code> – Path to the final CSV with fields, contexts, and options.</li>
      </ul>

      <h2>Outputs</h2>
      <ul>
        <li>
          <strong>Raw fields JSON</strong><br>
          A direct JSON dump of <code>/rest/api/3/field</code> for debugging and reference.<br>
          <span class="small-note">Example filename: <code>jira_custom_fields_raw_20251209_2304.json</code></span>
        </li>
        <li>
          <strong>Contexts &amp; options CSV</strong><br>
          A flattened table of field metadata, contexts, and options suitable for Excel, BI tools, or further scripting.<br>
          <span class="small-note">Example filename: <code>jira_custom_fields_contexts_options_20251209_2304.csv</code></span>
        </li>
      </ul>

      <!-- Optional: you can update these links to point to actual sample files in your repo -->
      <p class="small-note">
        (Optional) You can link sample outputs here:<br>
        – <code>Sample JSON:</code> <a href="#" target="_blank" rel="noopener">Coming soon</a><br>
        – <code>Sample CSV:</code> <a href="#" target="_blank" rel="noopener">Coming soon</a>
      </p>

      <h2>How It Runs (GitHub Actions)</h2>
      <p>
        This script is designed to run as a GitHub Actions workflow. The workflow:
      </p>
      <ul>
        <li>Checks out the repository and sets up a Python runtime.</li>
        <li>Installs the only required dependency (<code>requests</code>).</li>
        <li>Injects Jira credentials via GitHub Actions secrets into environment variables.</li>
        <li>Executes <code>Inventory.py</code> to generate the JSON and CSV artifacts.</li>
        <li>Uploads the generated files as downloadable artifacts from the workflow run.</li>
      </ul>
      <p class="small-note">
        This pattern keeps credentials out of the codebase and makes the script safe to publish in a public repository.
      </p>

      <h2>What This Demonstrates</h2>
      <ul>
        <li>Secure handling of Jira Cloud credentials via GitHub Actions secrets.</li>
        <li>Use of Jira Cloud REST API v3 with pagination and context-specific endpoints.</li>
        <li>Fallback strategies for retrieving custom field options (context API vs. editmeta).</li>
        <li>Exporting complex Jira configuration into analysis-ready CSVs.</li>
        <li>Automation of configuration inventory as a repeatable, versioned process.</li>
      </ul>
      <h2>Example Files</h2>
      <ul>
        <a href="files/jira_custom_fields_raw_20251210_0132.json" target="_blank">JSON</a> ·
        <a href="files/jira_custom_fields_contexts_options_20251210_0132.csv" target="_blank">CSV</a>
      </ul>
    </section>
  </main>
</body>
</html>
